version: v2

managed:
  enabled: true
  override:
    - file_option: optimize_for
      value: SPEED

inputs:
  - directory: proto
  - module: buf.build/bufbuild/protovalidate

plugins:
  # ==========================================
  # Python Generation (for uv)
  # ==========================================

  # Base Python protobuf
  - remote: buf.build/protocolbuffers/python:v33.0
    out: gen/python
    opt:
      - pyi_out=gen/python

  # Python gRPC
  - remote: buf.build/grpc/python:v1.76.0
    out: gen/python

  # ==========================================
  # TypeScript Generation (for yarn)
  # ==========================================

  # Protobuf-ES (modern TypeScript protobuf)
  - remote: buf.build/bufbuild/es:v2.10.0
    out: gen/typescript
    opt:
      - target=ts
      - import_extension=none

  # gRPC-Web (traditional)
  - remote: buf.build/grpc/web:v2.0.2
    out: gen/typescript
    opt:
      - import_style=typescript
      - mode=grpcwebtext
