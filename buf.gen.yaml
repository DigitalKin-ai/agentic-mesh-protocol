version: v2

managed:
  enabled: true
  override:
    - file_option: optimize_for
      value: SPEED

inputs:
  - directory: proto

plugins:
  # ==========================================
  # Python Generation (for uv)
  # ==========================================

  # Base Python protobuf
  - remote: buf.build/protocolbuffers/python:v33.0
    out: gen/python
    opt:
      - pyi_out=gen/python

  # Python gRPC
  - remote: buf.build/grpc/python:v1.76.0
    out: gen/python

  # ==========================================
  # TypeScript/Node.js Generation (for Node.js servers)
  # ==========================================

  # ts-proto for Node.js gRPC (compatible with @grpc/grpc-js)
  - local: protoc-gen-ts_proto
    out: gen/typescript
    opt:
      # Core options
      - outputServices=grpc-js        # Generate @grpc/grpc-js compatible code
      - outputClientImpl=grpc-js      # Generate client implementations
      - env=node                      # Node.js environment
      - esModuleInterop=true          # Better import compatibility
      - emitImportedFiles=false
      
      # Type safety
      - useOptionals=messages         # Optional fields as T | undefined
      - useDate=true                  # Use Date instead of Timestamp
      - forceLong=string              # Convert longs to strings

      # File organization
      - importSuffix=.js              # Add .js to imports (ES modules)

      # Naming conventions
      - snakeToCamel=keys             # Convert snake_case to camelCase

      # Code style
      - esLintDisable=true            # Add eslint-disable comments
