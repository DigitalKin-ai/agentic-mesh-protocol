// Copyright 2025 DigitalKin Inc.
//
// Licensed under the GNU General Public License, Version 3.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.gnu.org/licenses/gpl-3.0.html
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package agentic_mesh_protocol.module.v1;

import "agentic_mesh_protocol/setup/v1/setup_messages.proto";
import "buf/validate/validate.proto";
import "google/protobuf/struct.proto";

// ════════════════════════════════════ GetModuleInput ════════════════════════════════════ //

// Retrieves the input schema for a given module.
message GetModuleInputRequest {
  // The unique identifier of the module.
  string id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "module_id_prefix"
      expression: "this.startsWith('modules:')"
      message: "module_id must start with 'modules:'"
    },
    (buf.validate.field).cel = {
      id: "module_id_length"
      expression: "this.size() >= 9"
      message: "module_id must be at least 1 characters long"
    }
  ];
  // If true, returns the schema in LLM format.
  bool llm_format = 2 [(buf.validate.field).required = true];
}

// Response containing the input schema of the module.
message GetModuleInputResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The input schema of the module.
  google.protobuf.Struct input_schema = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ GetModuleOutput ════════════════════════════════════ //

// Retrieves the output schema for a given module.
message GetModuleOutputRequest {
  // The unique identifier of the module.
  string id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "module_id_prefix"
      expression: "this.startsWith('modules:')"
      message: "module_id must start with 'modules:'"
    },
    (buf.validate.field).cel = {
      id: "module_id_length"
      expression: "this.size() >= 9"
      message: "module_id must be at least 1 characters long"
    }
  ];
  // If true, returns the schema in LLM format.
  bool llm_format = 2 [(buf.validate.field).required = true];
}

// Response containing the output schema of the module.
message GetModuleOutputResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The output schema of the module.
  google.protobuf.Struct output_schema = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ GetModuleSetup ════════════════════════════════════ //

// Retrieves the setup schema for a given module.
message GetModuleSetupRequest {
  // The unique identifier of the module.
  string id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "module_id_prefix"
      expression: "this.startsWith('modules:')"
      message: "module_id must start with 'modules:'"
    },
    (buf.validate.field).cel = {
      id: "module_id_length"
      expression: "this.size() >= 9"
      message: "module_id must be at least 1 characters long"
    }
  ];
  // If true, returns the schema in LLM format.
  bool llm_format = 2 [(buf.validate.field).required = true];
}

// Response containing the setup schema of the module.
message GetModuleSetupResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The setup schema of the module.
  google.protobuf.Struct setup_schema = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ GetModuleSecret ════════════════════════════════════ //

// Retrieves the secret schema for a given module.
message GetModuleSecretRequest {
  // The unique identifier of the module.
  string id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "module_id_prefix"
      expression: "this.startsWith('modules:')"
      message: "module_id must start with 'modules:'"
    },
    (buf.validate.field).cel = {
      id: "module_id_length"
      expression: "this.size() >= 9"
      message: "module_id must be at least 1 characters long"
    }
  ];
  // If true, returns the schema in LLM format.
  bool llm_format = 2 [(buf.validate.field).required = true];
}

// Response containing the secret schema of the module.
message GetModuleSecretResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The secret schema of the module.
  google.protobuf.Struct secret_schema = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ GetConfigSetupModule ════════════════════════════════════ //

// Retrieves the configuration setup schema for a given module.
message GetConfigSetupModuleRequest {
  // The unique identifier of the module.
  string id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "module_id_prefix"
      expression: "this.startsWith('modules:')"
      message: "module_id must start with 'modules:'"
    },
    (buf.validate.field).cel = {
      id: "module_id_length"
      expression: "this.size() >= 9"
      message: "module_id must be at least 1 characters long"
    }
  ];
  // If true, returns the schema in LLM format.
  bool llm_format = 2 [(buf.validate.field).required = true];
}

// Response containing the configuration setup schema of the module.
message GetConfigSetupModuleResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The configuration setup schema of the module.
  google.protobuf.Struct config_setup_schema = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ ConfigSetupModule ════════════════════════════════════ //

// Configures the setup for a given module.
message ConfigSetupModuleRequest {
  // The setup version to configure.
  agentic_mesh_protocol.setup.v1.SetupVersion setup_version = 1 [(buf.validate.field).required = true];
  // The configuration content for the setup.
  google.protobuf.Struct content = 2 [(buf.validate.field).required = true];
  // The mission ID associated with the setup.
  string mission_id = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "mission_id_prefix"
      expression: "this.startsWith('missions:')"
      message: "mission_id must start with 'missions:'"
    },
    (buf.validate.field).cel = {
      id: "mission_id_length"
      expression: "this.size() >= 10"
      message: "mission_id must be at least 1 characters long"
    }
  ];
}

// Response confirming the configuration of the module setup.
message ConfigSetupModuleResponse {
  // Indicates if the operation was successful.
  bool success = 1 [(buf.validate.field).required = true];
  // The configured setup version.
  agentic_mesh_protocol.setup.v1.SetupVersion setup_version = 2 [(buf.validate.field).required = true];
}

// ════════════════════════════════════ StartModule ════════════════════════════════════ //

// Starts a module with the provided input and setup.
message StartModuleRequest {
  // The input data for the module.
  google.protobuf.Struct input = 1 [(buf.validate.field).required = true];
  // The setup ID to use for the module.
  string setup_id = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "setup_id_prefix"
      expression: "this.startsWith('setups:')"
      message: "setup_id must start with 'setups:'"
    },
    (buf.validate.field).cel = {
      id: "setup_id_length"
      expression: "this.size() >= 8"
      message: "setup_id must be at least 1 characters long"
    }
  ];
  // The mission ID associated with the module run.
  string mission_id = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "mission_id_prefix"
      expression: "this.startsWith('missions:')"
      message: "mission_id must start with 'missions:'"
    },
    (buf.validate.field).cel = {
      id: "mission_id_length"
      expression: "this.size() >= 10"
      message: "mission_id must be at least 1 characters long"
    }
  ];
}

// Response containing the output of the started module and job ID.
message StartModuleResponse {
  // Indicates if the operation was successful.
  bool success = 1;
  // The output data from the module.
  google.protobuf.Struct output = 2 [(buf.validate.field).required = true];
  // The job ID for the module run.
  string job_id = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "job_id_prefix"
      expression: "this.startsWith('jobs:')"
      message: "job_id must start with 'jobs:'"
    },
    (buf.validate.field).cel = {
      id: "job_id_length"
      expression: "this.size() >= 6"
      message: "job_id must be at least 1 characters long"
    }
  ];
}

// ════════════════════════════════════ StopModule ════════════════════════════════════ //

// Stops a running module by job ID.
message StopModuleRequest {
  // The job ID to stop.
  string job_id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).cel = {
      id: "job_id_prefix"
      expression: "this.startsWith('jobs:')"
      message: "job_id must start with 'jobs:'"
    },
    (buf.validate.field).cel = {
      id: "job_id_length"
      expression: "this.size() >= 6"
      message: "job_id must be at least 1 characters long"
    }
  ];
}

// Response confirming the stopping of the module.
message StopModuleResponse {
  // Indicates if the operation was successful.
  bool success = 1;
  // The job ID that was stopped (if available).
  optional string job_id = 2 [
    (buf.validate.field).required = false,
    (buf.validate.field).cel = {
      id: "job_id_prefix"
      expression: "this.startsWith('jobs:')"
      message: "job_id must start with 'jobs:'"
    },
    (buf.validate.field).cel = {
      id: "job_id_length"
      expression: "this.size() >= 6"
      message: "job_id must be at least 1 characters long"
    }
  ];
}
