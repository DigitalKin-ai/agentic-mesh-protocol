// Copyright 2025 DigitalKin Inc.
//
// Licensed under the GNU General Public License, Version 3.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.gnu.org/licenses/gpl-3.0.html
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package agentic_mesh_protocol.filesystem.v1;

import "buf/validate/validate.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// ════════════════════════════════════ Objects ═════════════════════════════════════ //

// FileType represents the classification of file types in the system.
enum FileType {
  // DOCUMENT represents document files (PDF, DOC, TXT, etc.).
  DOCUMENT = 0;
  // IMAGE represents image files (PNG, JPG, GIF, etc.).
  IMAGE = 1;
  // VIDEO represents video files (MP4, AVI, MOV, etc.).
  VIDEO = 2;
  // AUDIO represents audio files (MP3, WAV, etc.).
  AUDIO = 3;
  // ARCHIVE represents archive files (ZIP, TAR, etc.).
  ARCHIVE = 4;
  // CODE represents source code files.
  CODE = 5;
  // OTHER represents other file types.
  OTHER = 6;
}

// FileStatus represents the lifecycle status of a file in the system.
enum FileStatus {
  // UPLOADING indicates the file is currently being uploaded.
  UPLOADING = 0;
  // ACTIVE indicates the file is active and available for use.
  ACTIVE = 1;
  // PROCESSING indicates the file is being processed.
  PROCESSING = 2;
  // ARCHIVED indicates the file has been archived.
  ARCHIVED = 3;
  // DELETED indicates the file is marked for deletion.
  DELETED = 4;
}

// File represents a stored file with comprehensive metadata.
message File {
  // file_id: Unique identifier for the file (UUID)
  string file_id = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.uuid = true
  ];

  // context: Context ID linked to the file
  string context = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.pattern = "^(missions:|setups:).*$"
  ];

  // name: Name of the file (unique within context)
  string name = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // file_type: Type classification of the file
  FileType file_type = 4 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum.defined_only = true
  ];

  // content_type: MIME type of the file
  string content_type = 5 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // size_bytes: Size of the file in bytes
  int64 size_bytes = 6 [
    (buf.validate.field).required = true,
    (buf.validate.field).int64.gt = 0
  ];

  // checksum: SHA-256 checksum of the file content (SHA-256 format)
  string checksum = 7 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // metadata: Flexible metadata for additional file properties
  google.protobuf.Struct metadata = 8;

  // storage_uri: Internal URI for accessing the file content
  string storage_uri = 9 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // file_url: External URL for accessing the file content
  string file_url = 10 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // status: Current status of the file
  FileStatus status = 11 [(buf.validate.field).required = true];

  // content: The content of the file
  bytes content = 12 [(buf.validate.field).bytes.min_len = 1];
}

// FileFilter contains criteria for querying and filtering files.
message FileFilter {
  // names: Filter by file names (exact matches)
  repeated string names = 1;

  // file_ids: Filter by file IDs
  repeated string file_ids = 2 [(buf.validate.field).repeated.items.string.uuid = true];

  // file_types: Filter by file types
  repeated FileType file_types = 3 [
    (buf.validate.field).repeated.items.enum.not_in = 0,
    (buf.validate.field).repeated.items.enum.defined_only = true
  ];

  // context: Filter by context (required for scoping)
  string context = 4 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.pattern = "^(missions:|setups:).*$"
  ];

  // created_after: Filter files created after this timestamp
  google.protobuf.Timestamp created_after = 5;

  // created_before: Filter files created before this timestamp
  google.protobuf.Timestamp created_before = 6;

  // updated_after: Filter files updated after this timestamp
  google.protobuf.Timestamp updated_after = 7;

  // updated_before: Filter files updated before this timestamp
  google.protobuf.Timestamp updated_before = 8;

  // status: Filter by file status
  FileStatus status = 9;

  // content_type_prefix: Filter by content type prefix (e.g., "image/")
  string content_type_prefix = 10;

  // min_size_bytes: Filter files with minimum size
  int64 min_size_bytes = 11 [(buf.validate.field).int64.gt = 0];

  // max_size_bytes: Filter files with maximum size
  int64 max_size_bytes = 12 [(buf.validate.field).int64.gt = 0];

  // prefix: Filter by path prefix (e.g., "folder1/")
  string prefix = 13 [(buf.validate.field).string.pattern = "^[^/]*/?[^/]*$"];

  // content_type: Filter by content type
  string content_type = 14;
}

// FileResult wraps the result of a file operation which may succeed or fail.
message FileResult {
  // result contains either a successfully processed file or error information.
  oneof result {
    // file: Successfully processed file
    File file = 1;
    // error: Error information if operation failed
    string error = 2;
  }
}

// UploadFileData contains the data required for uploading a single file.
message UploadFileData {
  // context: Context ID for the file
  string context = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.pattern = "^(missions:|setups:).*$"
  ];

  // name: Name of the file
  string name = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // file_type: Type classification of the file
  FileType file_type = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum.defined_only = true
  ];

  // content_type: MIME type of the file
  string content_type = 4 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];

  // content: File content
  bytes content = 5 [
    (buf.validate.field).required = true,
    (buf.validate.field).bytes.min_len = 1
  ];

  // metadata: Additional metadata for the file
  google.protobuf.Struct metadata = 6;

  // status: Status of the file
  FileStatus status = 7 [(buf.validate.field).required = true];

  // replace_if_exists: Whether to replace existing file with same name
  bool replace_if_exists = 8;
}
